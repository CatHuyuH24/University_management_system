
-- CONNECT AS ATBMCQ_16_ADMIN

-- Tạo bảng DONVI
CREATE TABLE DONVI (
    MADV VARCHAR2(10),
    TENDV VARCHAR2(50) NOT NULL,
    LOAIDV VARCHAR2(10) CHECK (LOAIDV IN ('Khoa', 'Phòng')),
    TRGDV VARCHAR2(10),
    CONSTRAINT PK_DONVI PRIMARY KEY (MADV)
);

-- Tạo bảng NHANVIEN
CREATE TABLE NHANVIEN (
    MANV VARCHAR2(10),
    HOTEN VARCHAR2(50) NOT NULL,
    PHAI VARCHAR2(3) CHECK (PHAI IN ('Nam', 'Nu')),
    NGSINH DATE NOT NULL,
    LUONG NUMBER(10,2) CHECK (LUONG >= 0),
    PHUCAP NUMBER(10,2) CHECK (PHUCAP >= 0),
    DT VARCHAR2(15),
    VAITRO VARCHAR2(10) CHECK (VAITRO IN ('NVCB', 'GV', 'NV PĐT', 'NV PKT', 'NV TCHC', 'NV CTSV', 'TRGDV')) NOT NULL,
    MADV VARCHAR2(10),
    CONSTRAINT PK_NHANVIEN PRIMARY KEY (MANV),
    CONSTRAINT FK_NHANVIEN_DONVI FOREIGN KEY (MADV) REFERENCES DONVI(MADV)
);

-- Thêm ràng buộc khóa ngoại cho TRGDV sau khi tạo NHANVIEN
ALTER TABLE DONVI
ADD CONSTRAINT FK_DONVI_NHANVIEN FOREIGN KEY (TRGDV) REFERENCES NHANVIEN(MANV);

-- Tạo bảng SINHVIEN
CREATE TABLE SINHVIEN (
    MASV VARCHAR2(10),
    HOTEN VARCHAR2(50) NOT NULL,
    PHAI VARCHAR2(3) CHECK (PHAI IN ('Nam', 'Nu')),
    NGSINH DATE NOT NULL,
    DCHI VARCHAR2(100),
    DT VARCHAR2(15),
    KHOA VARCHAR2(10),
    TINHTRANG VARCHAR2(20) CHECK (TINHTRANG IN ('Đang học', 'Nghỉ học', 'Bảo lưu')),
    CONSTRAINT PK_SINHVIEN PRIMARY KEY (MASV),
    CONSTRAINT FK_SINHVIEN_DONVI FOREIGN KEY (KHOA) REFERENCES DONVI(MADV)
);

-- Tạo bảng HOCPHAN
CREATE TABLE HOCPHAN (
    MAHP VARCHAR2(10),
    TENHP VARCHAR2(50) NOT NULL,
    SOTC NUMBER CHECK (SOTC > 0),
    STLT NUMBER CHECK (STLT >= 0),
    STTH NUMBER CHECK (STTH >= 0),
    MADV VARCHAR2(10),
    CONSTRAINT PK_HOCPHAN PRIMARY KEY (MAHP),
    CONSTRAINT FK_HOCPHAN_DONVI FOREIGN KEY (MADV) REFERENCES DONVI(MADV)
);

-- Tạo bảng MOMON
CREATE TABLE MOMON (
    MAMM VARCHAR2(10),
    MAHP VARCHAR2(10),
    MAGV VARCHAR2(10),
    HK NUMBER CHECK (HK IN (1, 2, 3)),
    NAM NUMBER,
    CONSTRAINT PK_MOMON PRIMARY KEY (MAMM),
    CONSTRAINT FK_MOMON_HOCPHAN FOREIGN KEY (MAHP) REFERENCES HOCPHAN(MAHP),
    CONSTRAINT FK_MOMON_NHANVIEN FOREIGN KEY (MAGV) REFERENCES NHANVIEN(MANV)
);

-- Tạo bảng DANGKY
CREATE TABLE DANGKY (
    MASV VARCHAR2(10),
    MAMM VARCHAR2(10),
    DIEMTH NUMBER CHECK (DIEMTH >= 0 AND DIEMTH <= 10),
    DIEMQT NUMBER CHECK (DIEMQT >= 0 AND DIEMQT <= 10),
    DIEMCK NUMBER CHECK (DIEMCK >= 0 AND DIEMCK <= 10),
    DIEMTK NUMBER CHECK (DIEMTK >= 0 AND DIEMTK <= 10),
    CONSTRAINT PK_DANGKY PRIMARY KEY (MASV, MAMM),
    CONSTRAINT FK_DANGKY_SINHVIEN FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV),
    CONSTRAINT FK_DANGKY_MOMON FOREIGN KEY (MAMM) REFERENCES MOMON(MAMM)
);

-- Chèn dữ liệu mẫu cho DONVI
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV)
VALUES ('HOA', 'Khoa Hóa học', 'Khoa', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV)
VALUES ('CNTT', 'Khoa CNTT', 'Khoa', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV)
VALUES ('PĐT', 'Phòng Đào tạo', 'Phòng', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV)
VALUES ('TCHC', 'Phòng Tổ chức hành chính', 'Phòng', NULL);
INSERT INTO DONVI (MADV, TENDV, LOAIDV, TRGDV)
VALUES ('CTSV', 'Phòng Công tác sinh viên', 'Phòng', NULL);

-- Chèn dữ liệu mẫu cho NHANVIEN
INSERT INTO NHANVIEN (MANV, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV001', 'Nguyen Van A', 'Nam', TO_DATE('1980-01-01', 'YYYY-MM-DD'), 1000, 200, '0901234567', 'NVCB', 'HOA');
INSERT INTO NHANVIEN (MANV, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV002', 'Tran Thi B', 'Nu', TO_DATE('1985-02-02', 'YYYY-MM-DD'), 1200, 250, '0912345678', 'TRGDV', 'HOA');
INSERT INTO NHANVIEN (MANV, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV003', 'Le Van C', 'Nam', TO_DATE('1990-03-03', 'YYYY-MM-DD'), 800, 150, '0923456789', 'GV', 'CNTT');
INSERT INTO NHANVIEN (MANV, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV004', 'Pham Thi D', 'Nu', TO_DATE('1975-04-04', 'YYYY-MM-DD'), 1500, 300, '0934567890', 'NV TCHC', 'TCHC');
INSERT INTO NHANVIEN (MANV, HOTEN, PHAI, NGSINH, LUONG, PHUCAP, DT, VAITRO, MADV)
VALUES ('NV006', 'Hoang Van F', 'Nam', TO_DATE('1982-06-06', 'YYYY-MM-DD'), 1300, 250, '0946789012', 'TRGDV', 'CNTT');

-- Cập nhật TRGDV cho DONVI sau khi có dữ liệu NHANVIEN
UPDATE DONVI SET TRGDV = 'NV002' WHERE MADV = 'HOA';
UPDATE DONVI SET TRGDV = 'NV006' WHERE MADV = 'CNTT';

-- Chèn dữ liệu mẫu cho SINHVIEN
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG)
VALUES ('SV001', 'Nguyen Thi X', 'Nu', TO_DATE('2000-01-01', 'YYYY-MM-DD'), '123 Tran Hung Dao, HN', '0981234567', 'HOA', 'Đang học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG)
VALUES ('SV002', 'Tran Van Y', 'Nam', TO_DATE('2001-02-02', 'YYYY-MM-DD'), '456 Le Loi, HCM', '0982345678', 'CNTT', 'Đang học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG)
VALUES ('SV003', 'Le Thi Z', 'Nu', TO_DATE('2000-03-03', 'YYYY-MM-DD'), '789 Nguyen Trai, HN', '0983456789', 'HOA', 'Bảo lưu');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG)
VALUES ('SV004', 'Pham Van W', 'Nam', TO_DATE('2001-04-04', 'YYYY-MM-DD'), '101 Hai Ba Trung, HCM', '0984567890', 'CNTT', 'Nghỉ học');
INSERT INTO SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, DT, KHOA, TINHTRANG)
VALUES ('SV005', 'Hoang Thi V', 'Nu', TO_DATE('2000-05-05', 'YYYY-MM-DD'), '202 Ba Dinh, HN', '0985678901', 'HOA', 'Đang học');

-- Chèn dữ liệu mẫu cho HOCPHAN
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV)
VALUES ('HP001', 'Cơ sở dữ liệu', 3, 30, 15, 'CNTT');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV)
VALUES ('HP002', 'Hóa học đại cương', 4, 45, 15, 'HOA');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV)
VALUES ('HP003', 'Lập trình Java', 3, 30, 15, 'CNTT');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV)
VALUES ('HP004', 'Hóa phân tích', 3, 30, 15, 'HOA');
INSERT INTO HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, MADV)
VALUES ('HP005', 'An toàn bảo mật', 3, 45, 0, 'CNTT');

-- Chèn dữ liệu mẫu cho MOMON
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM)
VALUES ('MM001', 'HP001', 'NV003', 1, 2024);
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM)
VALUES ('MM002', 'HP002', NULL, 2, 2024);
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM)
VALUES ('MM003', 'HP003', 'NV003', 3, 2024);
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM)
VALUES ('MM004', 'HP004', NULL, 1, 2025);
INSERT INTO MOMON (MAMM, MAHP, MAGV, HK, NAM)
VALUES ('MM005', 'HP005', 'NV003', 2, 2025);

-- Chèn dữ liệu mẫu cho DANGKY
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV001', 'MM001', 8.0, 7.5, 8.5, 8.0);
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV002', 'MM001', 7.0, 6.5, 7.5, 7.0);
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV003', 'MM002', 6.0, 6.0, 6.5, 6.2);
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV004', 'MM003', 5.0, 5.5, 6.0, 5.5);
INSERT INTO DANGKY (MASV, MAMM, DIEMTH, DIEMQT, DIEMCK, DIEMTK)
VALUES ('SV005', 'MM002', 9.0, 8.5, 9.0, 8.8);

-- Commit dữ liệu
COMMIT;

-- Kiểm tra dữ liệu
SELECT * FROM DONVI;
SELECT * FROM NHANVIEN;
SELECT * FROM SINHVIEN;
SELECT * FROM HOCPHAN;
SELECT * FROM MOMON;
SELECT * FROM DANGKY;
